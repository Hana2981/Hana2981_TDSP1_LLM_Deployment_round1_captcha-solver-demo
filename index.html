<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Hello from FastAPI - Demo</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root { color-scheme: light dark; }
    body {
      margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      display: grid; place-items: center; min-height: 100vh; background: #0f172a; color: #e5e7eb;
    }
    .card {
      background: #111827;
      border: 1px solid #1f2937;
      border-radius: 12px;
      padding: 24px;
      width: min(600px, 92vw);
      box-shadow: 0 10px 30px rgba(0,0,0,0.35);
    }
    h1 { margin: 0 0 8px; font-size: 1.6rem; }
    p.sub { margin: 0 0 18px; color: #9ca3af; }
    .result {
      min-height: 48px; display: flex; align-items: center; justify-content: center;
      background: #0b1220; border: 1px solid #1f2937; border-radius: 10px; margin-top: 14px;
      font-size: 1.1rem;
    }
    .row { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
    input {
      flex: 1 1 320px; padding: 10px 12px; border-radius: 10px; border: 1px solid #1f2937;
      background: #0b1220; color: #e5e7eb; outline: none;
    }
    button {
      padding: 10px 14px; border-radius: 10px; border: 1px solid #334155; background: #2563eb;
      color: white; cursor: pointer;
    }
    button.secondary { background: #0b1220; color: #e5e7eb; }
    .muted { color: #9ca3af; font-size: 0.9rem; }
    .ok { color: #22c55e; }
    .err { color: #f87171; }
    .foot { margin-top: 12px; font-size: 0.85rem; color: #94a3b8; }
    .code { font-family: ui-monospace, SFMono-Regular, Menlo, monospace; background: #0b1220; padding: 2px 6px; border-radius: 6px; border: 1px solid #1f2937; }
  </style>
</head>
<body>
  <div class="card">
    <h1>FastAPI Hello Demo</h1>
    <p class="sub">Calls a FastAPI endpoint that returns: <span class="code">Hello from FastAPI</span></p>

    <div class="row" style="margin-bottom:10px">
      <input id="base" type="text" placeholder="API base URL" value="http://127.0.0.1:8000" />
      <button id="save" class="secondary" title="Save API base URL">Save</button>
      <button id="btn">Call API</button>
    </div>
    <div class="muted">Endpoint: <span class="code">GET /api/hello</span></div>

    <div id="status" class="foot"></div>
    <div id="out" class="result">Waiting to call API…</div>
  </div>

  <script>
    const baseInput = document.getElementById('base');
    const out = document.getElementById('out');
    const status = document.getElementById('status');
    const btn = document.getElementById('btn');
    const save = document.getElementById('save');

    // Load persisted base URL if present
    const saved = localStorage.getItem('fastapi_base');
    if (saved) baseInput.value = saved;

    save.addEventListener('click', () => {
      localStorage.setItem('fastapi_base', baseInput.value.trim());
      status.textContent = 'Saved API base URL.';
    });

    async function callApi() {
      const base = baseInput.value.trim().replace(/\/+$/, '');
      const url = base + '/api/hello';
      out.textContent = 'Calling ' + url + ' …';
      status.textContent = '';

      const t0 = performance.now();
      try {
        const res = await fetch(url, { cache: 'no-store' });
        const txt = await res.text();
        const ms = (performance.now() - t0).toFixed(0);
        if (!res.ok) {
          out.innerHTML = '<span class="err">HTTP ' + res.status + '</span>';
          status.innerHTML = 'Request failed in ' + ms + ' ms';
          return;
        }
        out.innerHTML = '<span class="ok">' + txt + '</span>';
        status.innerHTML = 'OK • ' + ms + ' ms';
      } catch (e) {
        out.innerHTML = '<span class="err">Connection error</span>';
        status.textContent = (e && e.message) ? e.message : String(e);
      }
    }

    btn.addEventListener('click', callApi);
    // Auto-call shortly after load so you see it working right away
    window.addEventListener('load', () => setTimeout(callApi, 150));
  </script>
</body>
</html>